---
title: 深入理解C++中的友元
date: 2022-10-08 16:35:40
tags: [技术, C++]
categories: 技术
index_img: /img/cpplogo.jpg
banner_img: /images/2y89my.jpg
---
### 关于友元函数和友元类
#### 1. 将非成员函数设置为类的友元函数
```cpp
class Student
{
private:
    int id;
    string name;
    int age;

public:
    Student(int sid, string sname, int sage) : age(sage), id(sid), name(sname){};
    friend void show(Student *s);
};

void show(Student *s)
{
    cout << s->id << " " << s->name << " " << s->age << endl;
}

int main()
{
    Student s(0, "张三", 18);
    show(&s);

    Student *ps = new Student(0, "张三", 18);
    show(ps);
    return 0;
}
```
通过将非成员函数show设置为Student类的友元函数，使得show能够访问Student类中的私有成员变量；

#### 2. 将成员函数设置为类的友元函数
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <cstring>

using namespace std;

class Teacher;  // 由于Student类中需要用到Teacher类，所以需要先声明类

class Student
{
private:
    int id;
    string name;
    int age;

public:
    Student(int sid, string sname, int sage) : age(sage), id(sid), name(sname){};
    void showTeacher(Teacher *teacher);
};

class Teacher
{
private:
    string name;

public:
    Teacher(string tname) : name(tname){};
    friend void Student::showTeacher(Teacher *teacher);
};

void Student::showTeacher(Teacher *teacher)
{
    cout << teacher->name << endl;
}

int main()
{
    Student s(0, "张三", 18);
    Teacher t("里斯");
    s.showTeacher(&t);

    Student *ps = new Student(0, "张三", 18);
    Teacher *pt = new Teacher("里斯");
    ps->showTeacher(pt);
    return 0;
}
```
通过在Teacher类中将Student类中的成员函数showTeacher设置为友元函数，从而使得在Student类中可以访问Teacher类中的私有成员变量name;

#### 3. 友元类
```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <cstring>

using namespace std;

class Student
{
private:
    int id;
    string name;
    int age;
    void print()
    {
        cout << id << " " << name << " " << age << endl;
    }

public:
    Student(int sid, string sname, int sage) : age(sage), id(sid), name(sname){};
    friend class Teacher;
};

class Teacher
{
private:
    string name;

public:
    Teacher(string tname) : name(tname){};
    void show(Student *s);
};

void Teacher::show(Student *s)
{
    s->print();
    cout << s->id << " " << s->name << " " << s->age << " " << name << endl;
}

int main()
{
    Student s(0, "张三", 18);
    Teacher t("里斯");
    t.show(&s);

    Student *ps = new Student(0, "张三", 18);
    Teacher *pt = new Teacher("里斯");
    pt->show(ps);
    return 0;
}
```
在Student类中将Teacher类声明为自己的友元类，使得Teacher类中能够使用Student类中的私有成员变量和成员函数；
1. 将类 B 声明为类 A 的友元类，那么类 B 中的所有成员函数都是类 A 的友元函数，可以访问类 A 的所有成员，包括 public、protected、private 属性的。
2. 一个函数可以被多个类声明为友元函数，这样就可以访问多个类中的 private 成员。
3. 友元的关系是单向的而不是双向的。如果声明了类 B 是类 A 的友元类，不等于类 A 是类 B 的友元类，类 A 中的成员函数不能访问类 B 中的 private 成员。
4. 友元的关系不能传递。如果类 B 是类 A 的友元类，类 C 是类 B 的友元类，不等于类 C 是类 A 的友元类。
5. 除非有必要，一般不建议把整个类声明为友元类，而只将某些成员函数声明为友元函数，这样更安全一些。
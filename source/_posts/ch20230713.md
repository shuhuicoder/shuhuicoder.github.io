---
title: 在Windows10中安装WSL1&2，并配置C/C++和VSCode环境
date: 2023-07-13 16:30:28
categories: 技术
index_img: /images/linuxlogo.png
banner_img: /images/linuxlogo.png
---
在WIndows中使用WSL来创建Linux子系统，并通过VSCode来进行连接方便本地开发和调试，虽然在微软的应用商店就可以直接下载Ubuntu等子系统WSL，但是却并没有CentOS系统的相关应用下载，因此需要自己进行安装配置。

WSL分为版本1和版本2，使用两个都可以，但是我在实际安装时，在使用VSCode连接WSL1的CentOS时，会出现VSCode扩展插件无法安装到子系统的问题，具体是报类似“EACCES: Permission Denied, rename”的错误；因此，我一直无法解决，于是后面我则是将WSL升级到版本2，则不再有此类问题。文章后面也会提到升级的方法。

### 1. 在Windows中使用 WSL 1 来安装CentOS子系统
#### 1. 在Windows10中开启WSL功能
- 1. 以管理员身份运行PowerShell
- 2. 在PowerShell中输入如下命令，命令将会输出系统的相关信息，目的是查看系统是否支持使用WSL功能；一般系统版本高于1709的都能支持；
  ```shell
  Get-ComputerInfo | Select WindowsProductName, WindowsVersion, WindowsInstallationType, OsServerLevel, OsVersion, OsHardwareAbstractionLayer
  ``` 
- 3. 继续在Power Shell中输入如下命令，来开启WSL功能，如果已经启用过了，则不会要求重启电脑；否则输入`y`并回车，来选择重启电脑以使功能生效；
    ```shell
    Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
    ```
#### 2. 在WSL中安装CentOS7
- 1. 下载一个可用于WSL的CentOS镜像，[GitHub中有一个开源的CenOS可用实例](https://github.com/wsldl-pg/CentWSL)；下载后解压将会看到2个文件：`rootfs.tar.gz`和`CentOS7.exe`；
- 2. 右键CenOS.exe以管理员身份运行，将该系统安装到WSL，稍等一会后，将会在程序安装的界面中看到`Installation Complete`的字样，则表明安装完成，按任意键即可退出安装；
- 3. 返回安装目录，可以发现多出了两个`rootfs`和`temp`两个目录，其中，`rootfs`内部就是CentOS内部的根目录及其相关的文件；随后再次右键运行`CentOS7.exe`，即可进入WSL中的CentOS系统；

#### 3. 在WSL中更新CentOS7
在WSL的CentOS7系统中键入如下命令即可对系统进行更新；
```shell
yum -y update
```

#### 4. 卸载或删除CentOS7
在CentOS7的安装目录中，即一开始的解压目录中，在该目录下以管理员身份打开Power shell，并运行如下命令，即可清理安装的CentOS7；
```shell
./CentOS7.exe clean
```

### 2. 升级使用WSL 2
#### 1. 下载WSL2 Linux 内核更新包
- 1. 通过链接地址来[下载WSL 2的更新包](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)
- 2. 运行下载的更新包

安装完成后，可以选择将WSL 2设置为默认版本，如果希望继续使用WSL 1则跳过该步骤;

#### 2. 将WSL 2设置为默认版本
打开PowerShell，并运行以下命令，将WSL 2设置为默认使用版本

```shell
WSL --set-default-version 2
```

#### 3. 安装CentOS7
这里就和前面安装的步骤一样

### 3. 配置C/C++和VSCode环境
- 1. CentOS中安装GCC, G++
    ```shell
    yum install -y gcc-c++
    ```
- 2. Windows本机中安装VSCode，然后首先是在本地安装`C/C++ Extension Pack`, 即C/C++的相关扩展插件，然后安装远程连接相关的扩展插件，包括`Remote-SSH, Remote Explorer, WSL`; 如果没有安装远程连接的相关插件，在将C/C++插件安装到WSL子系统中时会报错，即前面所说的类似错误；
- 3. 在VSCode中选择远程连接到WSL，然后在CentOS子系统中安装C/C++的相关扩展插件；这样做的目的是通过VSCode来连接到子系统方便编写、编译和调试代码，而在WSL中安装这些插件也可以使得在编写代码的过程中能够自动补全代码。

### Reference
1. [WSL 的基本命令](https://learn.microsoft.com/zh-cn/windows/wsl/basic-commands?redirectedfrom=MSDN)
2. [旧版 WSL 的手动安装步骤](https://learn.microsoft.com/zh-cn/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package)
3. [漫谈在Windows Server 2019中安装使用WSL](https://zhuanlan.zhihu.com/p/271927065) 
4. [在Windows 10上使用WSL安装Centos](https://zhuanlan.zhihu.com/p/272735470)
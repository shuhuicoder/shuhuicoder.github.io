---
title: 在Visual Studio 2019中的添加及配置jsoncpp
date: 2023-04-05 15:56:54
tags: [技术, C++, Windows]
categories: 技术
index_img: /images/json_logo.png
banner_img: /images/1pk58v.jpg
author: shuhui
---
这里是Windows环境下在Visual Studio 2019中配置jsoncpp的方法以及jsoncpp的基本使用做一个记录。
### 1. Visual Studio 2019添加和配置jsoncpp
jsoncpp的下载地址[https://sourceforge.net/projects/jsoncpp/]，本文中所使用的是0.5.0版本。使用jsoncpp也有两种方式，一种是在项目中包含cpp和h文件，第二种则是使用jsoncpp生成的lib文件。
#### 1.1 在项目种包含cpp和h文件
1. 解压下载的Jsoncpp文件，把jsoncpp-src-0.5.0文件拷贝到工程目录下；
2. 将```jsoncpp-src-0.5.0\jsoncpp-src-0.5.0\include\json```和```jsoncpp-src-0.5.0\jsoncpp-src-0.5.0\src\lib_json```目录里的文件包含到VS工程中;
    具体地，在 菜单栏->项目 选项中，选择显示所有文件，然后在项目文件夹```jsoncpp-src-0.5.0\jsoncpp-src-0.5.0\include\json```和```jsoncpp-src-0.5.0\jsoncpp-src-0.5.0\src\lib_json```上右击，选择“包含在项目中”。
3. 在VS工程的属性C/C++下General（常规）中Additional Include Directories（附加包含目录）包含头文件目录.\jsoncpp-src-0.5.0\include。配置路径为：属性管理器 -> C/C++ -> 常规 -> 附加包含目录：```.\jsoncpp-src-0.5.0\include```。
4. 在使用的cpp文件中包含json头文件即可，如：#include "json/json.h"。
5. 将json_reader.cpp、json_value.cpp和json_writer.cpp三个文件的Precompiled Header（预编译头）属性设置为Not Using Precompiled Headers（不使用预编译头），否则编译会出现错误。配置路径为：属性管理器 -> C/C++ -> 预编译头 -> 预编译头：不使用预编译头。

#### 1.2 使用jsonCPP生成的静态lib库文件
1. 解压下载的jsoncpp文件；
2. 在jsoncpp-src-0.5.0/makefiles/vs71目录里找到jsoncpp.sln，使用visual studio打开，注意，本文所使用的是visual studio2019版本，在打开时会要求进行兼容选项，确认兼容升级即可；
3. 生成解决方案，然后便可以在```\jsoncpp-src-0.5.0\build\vs71\debug\lib_json``中找到lib文件json_vc71_libmtd.lib，需要注意的是，如果选择的是release模式，则在release目录下存在生成的json_vc71_libmt.lib文件，文件名是不一样的！！！
4. 新建一个空白测试项目，然后在项目中的连接器中链接lib文件，具体操作路径为：项目属性管理器 -> 链接器 -> 输入 -> 附加依赖项 -> lib的路径；
5. 包含jsoncpp的include目录，其中包含.h头文件，具体操作路径为：属性管理器 -> C/C++ -> 附加包含目录 -> 编辑 -> 添加路径```\jsoncpp-src-0.5.0\include```即可；
6. 在测试cpp文件中，添加```#pragma comment(lib,"json_vc71_libmtd.lib")```，并包含头文件```#include "json/json.h"```即可正常使用；

NOTE：在测试运行时，需要在测试项目中使用与libku生成时使用一致的运行库，具体查看和操作路径为：属性管理器 -> C/C++ -> 代码生成 -> 运行库 -> 多线程调试(/MTd); 其中4个选项分别对应的含义如下：
- 多线程调试Dll (/MDd) 对应的是MD_DynamicDebug
- 多线程Dll (/MD) 对应的是MD_DynamicRelease
- 多线程(/MT) 对应的是MD_StaticRelease
- 多线程(/MTd)对应的是MD_StaticDebug

以下给出测试cpp代码, 该代码同样适用于1.1小节中的情况，只需注释或删除掉```#pragma comment(lib,"json_vc71_libmtd.lib")```即可。
```cpp
#pragma comment(lib,"json_vc71_libmtd.lib")

#include <iostream>
#include <string>
#include <fstream>
#include "json/json.h"

using namespace std;

int main()
{
    const char* str = "{\"uploadid\": \"UP000000\",\"code\": 100,\"msg\": \"hello world\",\"files\": \"a.txt\"}";

    Json::Reader reader;
    Json::Value root;
    if (reader.parse(str, root))  // reader将Json字符串解析到root，root将包含Json里所有子元素  
    {
        std::string upload_id = root["uploadid"].asString();  // 访问节点，upload_id = "UP000000"  

        int code = root["code"].asInt();    // 访问节点，code = 100 
        std::string msg = root["msg"].asString();
        std::string files = root["files"].asString();
        cout << upload_id << " : " << code << endl;
        cout << msg << " : " << files << endl;
    }

    return 0;
}
```

如有其他问题欢迎留言或私信讨论，谢谢。

### Inference
[1]https://blog.csdn.net/qq_40178343/article/details/112387810
[2]https://www.cnblogs.com/liaocheng/p/4243731.html
[3]https://blog.csdn.net/smalbig/article/details/113465183